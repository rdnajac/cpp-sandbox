
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of C++ code snippets and examples.">
      
      
        <meta name="author" content="Ryan D. Najac">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Sockets and Server Testing - C++ Sandbox</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sockets-and-server-testing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="C++ Sandbox" class="md-header__button md-logo" aria-label="C++ Sandbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            C++ Sandbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sockets and Server Testing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rdnajac/cpp-sandbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="C++ Sandbox" class="md-nav__button md-logo" aria-label="C++ Sandbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    C++ Sandbox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rdnajac/cpp-sandbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ sandbox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advprog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Programming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../qsort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quicksort
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCP Echo Server and Client
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../time-complexity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Complexity
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Tour of C++
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sockets-and-http" class="md-nav__link">
    <span class="md-ellipsis">
      Sockets and HTTP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sockets and HTTP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-socket" class="md-nav__link">
    <span class="md-ellipsis">
      What is a socket?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-client-server-model" class="md-nav__link">
    <span class="md-ellipsis">
      The client-server model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sockets-with-netcat" class="md-nav__link">
    <span class="md-ellipsis">
      Sockets with netcat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sockets-api-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Sockets API Summary
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listening-socket-vs-connected-socket" class="md-nav__link">
    <span class="md-ellipsis">
      Listening socket vs connected socket
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#http-10" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP 1.0
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-multi-server" class="md-nav__link">
    <span class="md-ellipsis">
      Testing your multi-server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing your multi-server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#siege" class="md-nav__link">
    <span class="md-ellipsis">
      Siege
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-guidance-on-testingbenchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Additional guidance on testing/benchmarking
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      Acknowledgements
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="sockets-and-server-testing">Sockets and Server Testing</h1>
<h2 id="sockets-and-http">Sockets and HTTP</h2>
<h3 id="what-is-a-socket">What is a socket?</h3>
<p>A socket is a software construct used for many modes of communication between
processes. The mode of communication that this recitation will focus on is
network communication. In particular, stream sockets represent an endpoint for
reliable, bidirectional connections such as TCP connections. This allows for two
processes, on separate computers, to communicate over a TCP/IP network
connection.</p>
<p>Sockets have:
- an IP address, to (typically) identify the computer that the socket endpoint
  belongs to
- a port number, to identify which process running on the computer the socket
  endpoint belongs to
- a protocol, such as TCP (reliable) or UDP (unreliable). Stream sockets use TCP</p>
<p>An IP address and port number are both required in order for a computer to
communicate with a specific process on a remote computer. </p>
<h3 id="the-client-server-model">The client-server model</h3>
<p>The two endpoints in a socket connection serve different roles. One end acts as
a <em>server</em>: 
- It tells the operating system that it should receive incoming connections on a
  port number
- It waits for incoming connections
- When it receives a connection, it creates a <em>new socket</em> for each client,
  which will then be used to communicate with that client</p>
<p>The other end is a <em>client</em>:
- It "connects" to the server using the server’s IP address and the port number</p>
<p>After a client connects to a server, there is bidirectional communication
between the two processes, often with I/O system calls such as <code>read()</code> and
<code>write()</code>, or their socket-specific variants <code>recv()</code> and <code>send()</code>. </p>
<h3 id="sockets-with-netcat">Sockets with netcat</h3>
<p>A simple way to demonstrate the bidirectional and network-based communcation of
sockets is with <code>netcat</code>. <code>netcat</code> is a bare-bones program to send streams of
binary data over the network.</p>
<p>Imagine we have two computers that can communicate over the internet, with the
IP addresses <code>clac.cs.columbia.edu</code> and <code>clorp.cs.nyu.edu</code>.</p>
<p>Because of the client-server model, connecting two socket endpoints to each
other is not a symmetrical process. One socket needs to act as the server, while
the other needs to act as a client. You tell <code>netcat</code> to act as a server with
the <code>-l</code> flag:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">joy@clac.cs.columbia.edu:~$ </span>nc<span class="w"> </span>-l<span class="w"> </span><span class="m">10000</span>
</span></code></pre></div>
<p>The <code>netcat</code> program on <code>clac.cs.columbia.edu</code> will create a socket and wait for
connections on port 10000. To tell <code>netcat</code> to act as a client, you supply the
IP address of the server and the port number of the socket listening on that
server:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gp">jeremy@clorp.cs.nyu.edu:~$ </span>nc<span class="w"> </span>clac.cs.columbia.edu<span class="w"> </span><span class="m">10000</span>
</span></code></pre></div>
<p>Notice the differences between these two commands. The first command only
requires a port number, and doesn't require the IP address of the other
computer. The second command requires knowledge of both the IP address (what
computer to connect to) and the port number (which process to connect to on that
computer). This asymmetry is the client-server model.</p>
<p>After the client connects to the server, the server <code>netcat</code> process creates a
new socket for bidirectional communicaiton. After the two processes connect
there is no functional difference between client and server. What you type on
one end should be visible on the other -- a full duplex stream of data. </p>
<h3 id="sockets-api-summary">Sockets API Summary</h3>
<p><img alt="" src="../img/client-server.png" /> </p>
<p><strong><code>socket()</code></strong>
- Called by both the client and the server
- On the server-side, a listening socket is created; a connected socket will be
  created later by <code>accept()</code></p>
<p><strong><code>bind()</code></strong>
- Usually called only by the server
- Binds the listening socket to a specific port that should be known to the
  client</p>
<p><strong><code>listen()</code></strong>
- Called only by the server
- Sets up the listening socket to accept connections</p>
<p><strong><code>accept()</code></strong>
- Called only by the server
- By default blocks until a connection request arrives
- Creates and returns a new socket for each client</p>
<p><strong><code>connect()</code></strong>
- Called only by the client
- Requires an IP address and port number to connect to
- Attempt to establish connection by reaching out to server</p>
<p><strong><code>send()</code> and <code>recv()</code></strong>
- Called by both the client and server
- Reads and writes to the other side
- Message boundaries may not be preserved
- nearly the same as <code>write()</code> and <code>read()</code>, but with socket-specific options</p>
<p>A TCP client may use these functions as such:
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(...);</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">connect</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="cm">/* server address */</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="c1">// Communicate with the server by send()ing from and recv()ing to fd.</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span></code></pre></div></p>
<p>And a TCP server:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">serv_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">socket</span><span class="p">(...);</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">bind</span><span class="p">(</span><span class="n">serv_fd</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="cm">/* server address */</span><span class="p">);</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">listen</span><span class="p">(</span><span class="n">serv_fd</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="cm">/* max pending connections */</span><span class="p">);</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="c1">// use an infinite loop, to continue accepting new incoming clients</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">clnt_fd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">accept</span><span class="p">(</span><span class="n">serv_fd</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="c1">// Communicate with the client by send()ing from and recv()ing to</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">    </span><span class="c1">// clnt_fd, NOT serv_fd.</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="n">close</span><span class="p">(</span><span class="n">clnt_fd</span><span class="p">);</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="listening-socket-vs-connected-socket">Listening socket vs connected socket</h3>
<p><img alt="" src="../img/listening-vs-connecting.png" /></p>
<p>To form a bidirectional channel between client and server, three sockets are used:
- The server uses two sockets
  - The listening socket, to accept incoming connections from a client
  - The client socket, which is created when an incoming connection has been
    <code>accept()</code>ed. 
- The client uses one socket
  - The <code>connect()</code>ing socket, which reaches out to the server. Once the
  connection has been made, communication can be done between the server's client
  socket and the client's connecting socket.</p>
<h3 id="http-10">HTTP 1.0</h3>
<p>HTTP 1.0 is a protocol between a client, typically a web browser, and a server,
typically a web server hosting files such as HTML. It is an outdated version of
the HTTP protocol and simpler than newer versions.</p>
<p>When visiting a website, a URL is specified in the following format:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>http://example.com:80/index.html
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>^^^^   ^^^^^^^^^^^ ^^^^^^^^^^^^^
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>|      |           | |
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>|      |           | URI = /index.html
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>|      |           port number = 80
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>|      domain name = example.com
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>protocol = HTTP
</span></code></pre></div>
<p>Based on the information provided by the user in the URL, a web client will
establish a socket connection with the IP address of the domain name. After
establishing the connection, the two computers exchange text in the form of HTTP
requests:</p>
<ul>
<li>The client sends an <strong>HTTP request</strong> for a resource on the server</li>
<li>The server sends an <strong>HTTP response</strong></li>
</ul>
<p><strong>HTTP request</strong>
- First line: method, request URI, version
    - Ex: "GET /index.html HTTP/1.0\r\n"
- Followed by 0 or more headers
    - Ex: "Host: www.google.com\r\n"
- Followed by an empty line
    - "\r\n"</p>
<p><strong>HTTP response</strong>
- First line: response status
    - Success: "HTTP/1.0 200 OK\r\n"
    - Failure: "HTTP/1.0 404 Not Found\r\n"
- Followed by 0 or more response headers
- Followed by an empty line
    - "\r\n"
- Followed by the content of the response
    - Ex: image file or HTML file</p>
<p>We can see the contents of real HTTP requests using <code>netcat</code> by pretending to be
either a web client or server. Our client and server won't actually work, since
they simply recieve the incoming request but do nothing to process the request
or reply. </p>
<p>Let's first act as a web server. We tell <code>netcat</code> to open a server connection
with <code>nc -l 10000</code>, and then in a web browser navigate to the URL with the
domain name of this server. We can use the domain name <code>localhost</code> to specify
the local computer rather than connecting to a remote computer over the
internet. In Chrome, we'll navigate to the URL
<code>http://localhost:10000/index.html</code>. <code>netcat</code> outputs this:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="gp">$ </span>nc<span class="w"> </span>-l<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="go">GET /index.html HTTP/1.1   # GET == method; /index.html == request URI; HTTP/1.1 == version</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">Host: localhost:10000      # header</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">Connection: keep-alive     # more headers...</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">-removed for brevity-</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="gp">                           # </span>blank<span class="w"> </span>newline<span class="w"> </span>to<span class="w"> </span>indicate<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>headers/request
</span></code></pre></div>
<p>To act as a client, we can type our HTTP request manually into netcat rather
than doing it through the web browser. Here, we try to send an HTTP request to
the domain name <code>example.com</code> on port <code>80</code> (the default for HTTP web servers)
for the URI <code>/index.html</code>. Note that we specify the <code>-C</code> with <code>netcat</code> so that
newlines are <code>\r\n</code> rather than <code>\n</code> -- a requirement of the HTTP protocol. This
flag may vary depending on <code>netcat</code> version -- check <code>man nc</code>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp">$ </span>nc<span class="w"> </span>-C<span class="w"> </span>example.com<span class="w"> </span><span class="m">80</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">GET /index.html HTTP/1.0    # GET == method; /index.html == request URI; HTTP/1.1 == version</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="gp">                            # </span>blank<span class="w"> </span>line<span class="w"> </span>to<span class="w"> </span>specify<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>request
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">HTTP/1.0 200 OK             # start of HTTP response. HTTP/1.0 == version; 200 OK == response status</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">Accept-Ranges: bytes        # header</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">Content-Type: text/html     # more headers...</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">-removed for brevity-</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="gp">                            # </span>blank<span class="w"> </span>newline<span class="w"> </span>to<span class="w"> </span>indicate<span class="w"> </span>end<span class="w"> </span>of<span class="w"> </span>headers<span class="w"> </span>and<span class="w"> </span>start<span class="w"> </span>of<span class="w"> </span>file<span class="w"> </span>contents
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="go">&lt;!doctype html&gt;             # HTML contents</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="go">&lt;html&gt;</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="go">&lt;head&gt;</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="go">    &lt;title&gt;Example Domain&lt;/title&gt;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="go">-removed for brevity-</span>
</span></code></pre></div>
<h2 id="testing-your-multi-server">Testing your multi-server</h2>
<h3 id="siege">Siege</h3>
<p>Siege is a command-line tool that allows you to benchmark your webserver using
load testing. Given a few parameters, Siege gives you information about the
number of successful transactions to your website, percent availability, the
latency/throughput of your server, and more.</p>
<p>To install siege, run the following command:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>sudo apt install siege
</span></code></pre></div>
<p>To use siege with your webserver in HW3, run your server and test with the
following command:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>siege http://&lt;hostname&gt;:&lt;port&gt;/&lt;url&gt;
</span></code></pre></div>
<p>This will run for an infinite amount of time. When you
<kbd>Ctrl</kbd>-<kbd>C</kbd> out of the command, a list of statistics will be
outputted on your terminal.</p>
<p>A better way to test with siege is using its options. The <code>-c</code> and <code>-r</code> options
are particularly useful, as they allow you to specify the number of concurrent
"users" and repetitions per user, respectively. For example, the following
command will create 25 concurrent users that will each attempt to hit the server
50 times, resulting in 1250 hit attempts:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>siege -c 25 -r 50 http://&lt;hostname&gt;:&lt;port&gt;/&lt;URI&gt;
</span></code></pre></div>
<p>There are many other options, specified in the siege man page. These include
<code>-t</code>, which specifies how long each user should run (as opposed to how many
times), and <code>-f</code>, which specifies a file path that contains a list of URLs to
test. </p>
<h3 id="additional-guidance-on-testingbenchmarking">Additional guidance on testing/benchmarking</h3>
<p>When grading, we're going to test your implementation using a mix of manual
connections (e.g. using tools like netcat) and stress testers like siege.</p>
<p>You should use <code>netcat</code> to make sure that basic functionality works and that you
can indeed have more than 1 connection to the server at any given time. <code>netcat</code>
is nice because it allows you to establish a connection and then prompts you for
the data to send. You should also use <code>netcat</code> to test that your cleanup logic
is correct, as you can control exactly when connections start/terminate.</p>
<p>Your server should be resilient to any client failure. <code>netcat</code> is a useful tool
to test these kinds of failures, as you can simulate bad requests or
disconnections at various points during the transaction. Your server should be
able to gracefully handle these scenarios -- under no condition should your
server crash because of a client failure.</p>
<p>Once you've tested the basic functionality, use a stress tester to make sure
that your server handles concurrent hoards of requests in a reasonable amount of
time. Since we're all on VMs running on different host machines, we can't really
say "X requests must finish in Y seconds". We're just looking to make sure that
your server doesn't take years (e.g. because it is actually serializing
requests).</p>
<p>Our grading scripts make heavy use of siege url files. siege will basically make
requests using the URLs specified in this file. Use this to make sure your
server can concurrently handle all kinds of requests and correctly respond to
all of them (2xx, 4xx, 5xx, multi-server never responds with 3xx).</p>
<p>Regarding benchmarking, the assignment prompt occasionally instructs you to
compare the performance of the implementation of one part with another. However,
since you are testing multi-server in a virtual machine, the performance isn’t
guaranteed to be significantly better. As such, don’t worry too much about the
benchmarking instructions - it’s not a hard and fast requirement.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<ul>
<li>Some examples were taken from John Hui's <a href="https://cs3157.github.io/www/2022-9/">Advanced
  Programming</a> lecture notes. We recommend
  reading them on top of these recitation notes.</li>
<li><a href="https://cs3157.github.io/www/2022-9/lecture-notes/13-tcp-ip.pdf">Lecture 13 - TCP/IP Networking</a></li>
<li><a href="https://cs3157.github.io/www/2022-9/lecture-notes/14-http.pdf">Lecture 14 - HTTP</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023&ndash;2024 <a href="https://rdnajac.tech">Ryan D. Najac</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>