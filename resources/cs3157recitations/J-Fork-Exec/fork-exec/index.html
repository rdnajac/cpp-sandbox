
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of C++ code snippets and examples.">
      
      
        <meta name="author" content="Ryan D. Najac">
      
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>Fork exec - C++ Sandbox</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"JetBrains Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nix-systems" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="C++ Sandbox" class="md-header__button md-logo" aria-label="C++ Sandbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            C++ Sandbox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fork exec
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/rdnajac/cpp-sandbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="C++ Sandbox" class="md-nav__button md-logo" aria-label="C++ Sandbox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    C++ Sandbox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rdnajac/cpp-sandbox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++ sandbox
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../advprog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced Programming
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../qsort/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quicksort
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tcp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TCP Echo Server and Client
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../time-complexity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Time Complexity
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tour/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A Tour of C++
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nix-systems" class="md-nav__link">
    <span class="md-ellipsis">
      *nix Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="*nix Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-stack" class="md-nav__link">
    <span class="md-ellipsis">
      The Stack
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#users-and-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      Users and Permissions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processes" class="md-nav__link">
    <span class="md-ellipsis">
      Processes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Processes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-new-processes-with-forkexec" class="md-nav__link">
    <span class="md-ellipsis">
      Creating New Processes with fork/exec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dealing-with-terminated-processes" class="md-nav__link">
    <span class="md-ellipsis">
      Dealing with Terminated Processes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#jaes-shellc-program" class="md-nav__link">
    <span class="md-ellipsis">
      Jae's shell.c Program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Jae's shell.c Program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    <span class="md-ellipsis">
      Variables ###
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#system-calls" class="md-nav__link">
    <span class="md-ellipsis">
      System Calls ###
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signals-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Signals (Optional) ###
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Fork exec</h1>

<h2 id="nix-systems">*nix Systems</h2>
<h3 id="the-stack">The Stack</h3>
<ol>
<li>Hardware: These are the physical components, i.e. the processor, disk, keyboard, etc...</li>
<li>OS Kernel: The kernel is the core of an operating system that loads first, controls resources, and performs fundamental tasks.</li>
<li>System Calls: These are calls/requests for kernel operations. Some examples are <code>open()</code>, <code>signal()</code>, <code>fork()</code> and <code>exec()</code>. We'll see <code>fork</code> and <code>exec</code> in detail in this document.  </li>
<li>Library Functions: These are inbuilt functions that come with programming language and perform specific functions, e.g. <code>printf()</code>, <code>malloc()</code></li>
<li>Applications: These are the end-user programs like emacs, gcc, and executables you build in class. </li>
</ol>
<h3 id="users-and-permissions">Users and Permissions</h3>
<p>Unix systems have three different ways to allocate permissions: owner (a user),
group, and everyone else. The owner can always assign owner permissions to another user. The <em>root user</em> has all permissions by default. </p>
<p>There are three UNIX file permissions. Read, write, and execute. Always think of
them in this order. Permissions are conventionally represented as combinations of 3 binary digits.
Each digit represents one of read, write and execute. So for example, 110 is the
ability to write and read and is a value of 6. (100-&gt; read-&gt; value of 4. 111 -&gt; read, write, execute -&gt; value of 7). Conventionally, you could combine these in the order owner-group-other in a string like "644" which would mean the owner can
write/read, and the group and others can only read. <code>chmod ### path</code> can
be used to set permissions for a path. Note that you can view permissions 
(among other things) of files in your current directory by entering <code>ls -al</code>. See the <code>ls</code> man page for more information. </p>
<h3 id="processes">Processes</h3>
<p>A program is a packaged set of instructions, whereas a process is an instance of a program. A program can have
many processes associated with it. For example, we can run multiple instances of
an executable independently, thereby initiating multiple processes that run that 
program. We can create more processes associated with the executable by splitting
a process with the <code>fork</code> system call, as we'll soon see.</p>
<p>Each process has a unique, non-negative numeric identifier known as the <strong>process ID</strong>. You can use <code>getpid()</code> to get the process ID of the current process.</p>
<h4 id="creating-new-processes-with-forkexec">Creating New Processes with fork/exec</h4>
<p>We can create new processes using the <code>fork</code> system call from an existing process. <code>fork()</code> creates a new process by duplicating the current process, and each process executes from the point of the <code>fork()</code> call. Fork duplicates the entire virtual address space when creating the new process. This means it duplicates the stack, the heap, the tasks, etc. The caller of fork is known as 
the parent process and the process getting created is known as the child process. <code>fork()</code> returns 0 in the child process, and the process ID of the new (child) process in the parent process. One of the most common uses of forking--which is what you'll be using forking for
in lab 5--is to run other programs via an existing process. That is, you'll have
a running process that will fork itself and, while the parent continues executing
the original program instructions, the child will transform into another process.
How do we transform the child?</p>
<p>You can use the <code>exec()</code> family of functions to <em>turn your current process</em> into
an instance of another program. The new program is specified in the arguments to
the <code>exec()</code> call. Once the call to <code>exec()</code> has been made, the process running
<code>exec()</code> will cease to execute the code of its original program and begin executing
the code of the new program. Your process has no memory (ha-ha) of the previously 
running program, i.e., its program code, data, heap, and stack are replaced with 
those of the new program. If the program reaches its end, the process will exit 
and will never return to the code of your old program. This means that any code 
following a call to <code>exec()</code> will only be executed if the call to <code>exec()</code> fails. For lab 5, you'll be dealing with the <code>execl()</code> function. </p>
<p>Fork and executing is how the entire operating system works. The kernel starts
an <code>init</code> process and everything is fork/exec'ed from there.</p>
<h4 id="dealing-with-terminated-processes">Dealing with Terminated Processes</h4>
<p>So what happens when the child process terminates before the parent process?
The parent is responsible for ensuring that the child process is "reaped", so
to speak. In other words, the system resources associated with the child 
process need to be released. Otherwise, the child will become a "zombie" process.
Ah, CS humor. We can release these resources using the <code>wait()</code> family of functions. In lab 5,
you'll be using <code>waitpid()</code>, which can wait for a process with a specific ID,
as well as other categories of processes. Check out its man page for more info. If a parent terminates before its child, the child 
becomes an "orphaned" process. If you're interested in orphan and zombie processes, 
you can check out the optional part 2 of lab 5. </p>
<p>For a fun fork/exec example, check out the <code>jsh</code> program in the 
<a href="https://github.com/cs3157/recitations/tree/master/J-Fork-Exec/code">recitation-J-code directory</a>. </p>
<p>Now, let's go through Jae's shell.c program from lecture and see these system calls in action. You can find the complete code in /home/jae/cs3157-pub/sample-code/fork-exec. </p>
<h2 id="jaes-shellc-program">Jae's shell.c Program</h2>
<h3 id="variables">Variables ###</h3>
<p><div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span><span class="kt">char</span><span class="w">  </span><span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="kt">int</span><span class="w">   </span><span class="n">status</span><span class="p">;</span>
</span></code></pre></div>
Aside from the buffer, we declare a variable <code>pid</code> of type <code>pid_t</code>. <code>pid_t</code> is a signed integer data type that represents proccess IDs. We also declare an integer variable, <code>status</code>, to store process status information. We'll see how later, during the <code>waitpid()</code> function call. </p>
<h3 id="system-calls">System Calls ###</h3>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">  </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
</span></code></pre></div>
<p><code>fork()</code> will duplicate your current (parent) process, creating a new (child) process. Each will execute from the point of the fork. <code>fork()</code> is called once in the parent, but returns 
twice: once in the parent and once in the child. The return value of <code>fork()</code> 
depends on if it's executing within the child process or parent process. <code>fork()</code> 
will return the process id of the child if it's executing within the parent, and 
it will return 0 of it's executing within the child process. <code>fork()</code> returns -1 if it fails. This means you can 
identify which process you are in simply by checking the return of <code>fork()</code>. Note
that the process ID of the child process is <strong>NOT</strong> equal to 0. Also note that
the order of execution of the child and parent processeses relative to each other
is unpredictable (which <code>waitpid</code> can remedy).  </p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">            </span><span class="c1">// child process</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">            </span><span class="n">execl</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">            </span><span class="n">die</span><span class="p">(</span><span class="s">&quot;execl failed&quot;</span><span class="p">);</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The above block of code is only executed in the child process (where <code>pid == 0</code>). <code>execl()</code> completely replaces the child process image with the new one - an instance of the program passed through <code>buf</code>. The first argument of <code>exec()</code> family of functions is the path of the file to be executed. The second argument, by convention, is the filename of the file to be executed (hence <code>buf</code> being passed in twice). Subsequent arguments are arguments to pass into the file to be executed. The list of parameters must <strong>always</strong> be ended by <code>NULL</code> pointer cast to <code>char *</code> to show the end of the argument list. The above block calls <code>execl()</code> with just the file to be run and no arguments. Once <code>execl()</code> is called and succeeds, the process is turned into an instance of the program pointed to by <code>buf</code> - nothing beyond the <code>execl()</code> call in the original program is executed unless <code>execl()</code> fails. </p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">            </span><span class="c1">// parent process</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">pid</span><span class="p">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">                </span><span class="n">die</span><span class="p">(</span><span class="s">&quot;waitpid failed&quot;</span><span class="p">);</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<p>The above block of code is only executed in the parent process (where <code>p &gt; 0</code>). <code>waitpid()</code> is used to wait or check for state changes in child processes. <code>waitpid()</code> takes in three arguments. The first is a number of type <code>pid_t</code>. This can be a specific process ID of a child process, or an integer representing other categories of process. In the case above, it passes in the process ID of its child to <code>waitpid()</code>. In lab 5, you'll see a case where <code>waitpid()</code> is called with -1. The second argument is a pointer to <code>status</code>, telling <code>waitpid()</code> to save state information in that variable. State information could be signals set in the process, exits and terminations or errors. (There's an <strong>optional</strong> section at the bottom of this argument on Signals if you'd like to know more. <a href="http://titania.ctie.monash.edu.au/signals/">This</a> is also a good resource for Unix Signals.) If <code>NULL</code> is passed instead of a pointer to variable, then state information is not saved. <code>status</code> can be used with a variety of functions to inspect/get information about child process. The third argument is an option parameter. <code>0</code> tells <code>waitpid()</code> to put off returning until child process or processes have changed state or terminated. In lab5, we'll see the <code>WNOHANG</code> option that tells <code>waitpid()</code> to <strong>not</strong> wait for child processes to terminate and return immediately if children are still running. In the above block, <code>waitpid()</code> returns the process ID of the child it waited for. For different return values with different options and arguments, check out the <code>waitpid</code> man page.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">printf</span><span class="p">(</span><span class="s">&quot;AP&gt; &quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>The <code>printf()</code> statement above is executed only by the parent process, once the child process has terminated. Remember, the child process never gets to this point because it was replaced by a different instance, and the parent has to wait for the child before it continues through the loop. After printing, the while loop will star over, going through everything again until the parent process is terminated. </p>
<h3 id="signals-optional">Signals (Optional) ###</h3>
<p>Signals are an OS's way of communicating with a process outside of the I/O
streams. They can be sent at any time and a process has three options upon
receiving them:</p>
<ol>
<li>Let the default action take place</li>
<li>Explicitly ignore the signal (not necessarily possible)</li>
<li>Catch the signal and do something special (not necessarily possible)</li>
</ol>
<p>There are tons of signals and each one has a number associated with it. Ctrl-C
for example is a signal, SIGINT for signal interrupt. You can use the <code>signal()</code>
function to set your program up to handle these signals. <code>signal()</code> takes two
arguments: the signal you want to handle, and a function pointer to a function
of what to do if that signal is received. Not all signals can always be caught
with this method, so it is convention to wrap the call to signal as follows:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">if</span><span class="p">(</span><span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">myHandler</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SIG_ERR</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="n">perror</span><span class="p">(</span><span class="s">&quot;call to signal() failed&quot;</span><span class="p">);</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>In this way, if the call to signal is not accepted by the operating system you
will be aware and can respond appropriately. In this case we simply exit the
program with an error code but this might not be the best behavior. Note that to
use these constants and functions you must <code>#include &lt;signal.h&gt;</code>. Also be aware
that you can only catch the first reception of the signal. The call to signal
will set the action to be taken to "myHandler" but afterwards it will be reset
to the default action for that signal. Page 255 in the K&amp;R has a little bit more
information on this.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023&ndash;2024 <a href="https://rdnajac.tech">Ryan D. Najac</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy"], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>